<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <record id="edit_project_prescription_form_inherit" model="ir.ui.view">
        <field name="name">project.project.form.inherit</field>
        <field name="model">project.project</field>
        <field name="inherit_id" ref="project.edit_project"/>
        <field name="priority">33</field>
        <field name="arch" type="xml">
            <xpath expr="//group[@name='group_prescriptions_analytics']" position="attributes">
                <attribute name="string">Prescriptions &amp; Analytics</attribute>
                <attribute name="invisible">False</attribute>
            </xpath>
            <xpath expr="//setting[@name='analytic_div']" position="before">
                <setting class="col-lg-12" help="Categorize and share your prescriptions with your customers" id="prescriptions_setting">
                    <field name="use_prescriptions"/>
                    <div invisible="not use_prescriptions" class="mt-3">
                        <div class="row">
                            <div class="col-auto pe-0">
                                <label for="prescriptions_folder_id" class="fw-bold"/>
                            </div>
                            <div class="col-9 ps-0">
                                <field name="prescriptions_folder_id" class="ps-2 w-100" context="{'prescriptions_project': True, 'default_company_id': company_id}"/>
                            </div>
                        </div>
                        <div class="row" invisible="not prescriptions_folder_id">
                            <div class="col-auto pe-0">
                                <label for="prescriptions_tag_ids" class="fw-bold"/>
                            </div>
                            <div class="col-9 ps-0">
                                <field name="prescriptions_tag_ids" class="ps-2 w-100" widget="many2many_tags" options="{'no_quick_create': True}" context="{'form_view_ref': 'prescriptions_project.tag_view_form_inherit', 'prescriptions_project_folder': prescriptions_folder_id}"/>
                            </div>
                        </div>
                    </div>
                </setting>
            </xpath>
        </field>
    </record>

    <record id="action_view_prescriptions_project_task" model="ir.actions.act_window">
        <field name="name">Prescriptions</field>
        <field name="res_model">prescriptions.prescription</field>
        <field name="view_mode">kanban,tree,form</field>
        <field name="domain">[('res_model', '=', 'project.task'), ('res_id', '=', active_id)]</field>
        <field name="context">{'default_res_model': 'project.task', 'default_res_id': active_id, 'limit_folders_to_project': True}</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                Upload <span class="fw-normal">a file or </span>drag <span class="fw-normal">it here.</span>
            </p>
        </field>
    </record>

    <record id="view_task_form2_prescription_inherit" model="ir.ui.view">
        <field name="name">project.task.form.inherit</field>
        <field name="model">project.task</field>
        <field name="inherit_id" ref="project.view_task_form2"/>
        <field name="arch" type="xml">
            <xpath expr="//div[@name='button_box']" position="inside">
                <field name="project_use_prescriptions" invisible="1"/>
                <button class="oe_stat_button" name="action_view_prescriptions_project_task" groups="prescriptions.group_prescriptions_user"
                    type="object" icon="fa-file-text-o" invisible="not project_use_prescriptions or not id" context="{'default_partner_id': partner_id}">
                    <field string="Prescriptions" name="prescription_count" widget="statinfo"/>
                </button>
            </xpath>
        </field>
    </record>

    <record id="project_sharing_project_task_view_form_inherit" model="ir.ui.view">
        <field name="name">project.sharing.project.task.view.form.inherit</field>
        <field name="model">project.task</field>
        <field name="inherit_id" ref="project.project_sharing_project_task_view_form"/>
        <field name="arch" type="xml">
            <xpath expr="//div[@name='button_box']" position="inside">
                <field name="project_use_prescriptions" invisible="1" groups="prescriptions.group_prescriptions_user"/>
                <field name="shared_prescription_ids" invisible="1" groups="prescriptions.group_prescriptions_user"/>
                <button class="oe_stat_button" name="action_open_shared_prescriptions" type="object" icon="fa-file-text-o" invisible="not project_use_prescriptions or not shared_prescription_ids" groups="prescriptions.group_prescriptions_user">
                    <field string="Prescriptions" name="prescription_count" widget="statinfo"/>
                </button>
            </xpath>
        </field>
    </record>

    <record id="project_view_kanban_inherit_prescriptions" model="ir.ui.view">
        <field name="name">project.kanban.inherit.prescriptions</field>
        <field name="model">project.project</field>
        <field name="inherit_id" ref="project.view_project_kanban"/>
        <field name="priority">27</field>
        <field name="arch" type="xml">
            <xpath expr="//div[hasclass('o_kanban_manage_view')]" position="inside">
                <field name="use_prescriptions" invisible="1"/>
                <div role="menuitem" groups="prescriptions.group_prescriptions_user" invisible="not use_prescriptions">
                    <a name="action_view_prescriptions_project" type="object">Prescriptions</a>
                </div>
            </xpath>
        </field>
    </record>
</odoo>
