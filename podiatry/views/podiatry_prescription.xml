<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Tree View -->
    <record id="view_podiatry_prescription_list" model="ir.ui.view">
        <field name="name">Practitioner Prescriptions</field>
        <field name="model">podiatry.prescription</field>
        <field name="arch" type="xml">
            <tree decoration-muted="state in ['done', 'cancel']" decoration-bf="state=='open'">
                <header>
                    <button type="action" name="%(action_prescription_message)d" string="Send Messages" />
                </header>
                <field name="state" invisible="True" />
                <field name="name"/>
                <field name="date"/>
                <field name="request_date" />
                <field name="practice_id"/>
                <field name="practitioner_id"/>
                <field name="patient_id"/>
                <field name="user_id" />
                <field name="num_prescriptions" sum="Num. Prescriptions" />
                <!-- <field name="diagnosis_id"/> -->
                <!-- <field name="description"/> -->
                <field name="description" optional="hide"/>

            </tree>
        </field>
    </record>
    <!-- Kanban View -->
    <!-- <record id="podiatry_prescription_kanban_view" model="ir.ui.view">
        <field name="name">podiatry.prescription.kanban.view</field>
        <field name="model">podiatry.prescription</field>
        <field name="arch" type="xml">
            <kanban default_group_by="state" class="o_kanban_small_column" quick_create="false" on_create="quick_create">
                <field name="color" />
                <field name="patient_id"/>
                <field name="practice_id"/>
                <field name="practitioner_id"/>
                <field name="practitioner_phone" invisible="1" />
                <field name="practitioner_email" invisible="1" />
                <field name="state"/>
                <field name="prescription_date"/>
                <templates>
                    <t t-name="kanban-box">
                        <div t-attf-class="#{kanban_color(record.color.raw_value)} oe_kanban_global_click">
                            <div class="o_dropdown_kanban dropdown">
                                <a role="button" class="dropdown-toggle o-no-caret btn" data-toggle="dropdown" href="#" aria-label="Dropdown menu" title="Dropdown menu">
                                    <span class="fa fa-ellipsis-v" />
                                </a>
                                <div class="dropdown-menu" role="menu">
                                    <t t-if="widget.editable">
                                        <a role="menuitem" type="edit" class="dropdown-item">Edit...</a>
                                    </t>
                                    <t t-if="widget.deletable">
                                        <a role="menuitem" type="delete" class="dropdown-item">Delete</a>
                                    </t>
                                    <ul class="oe_kanban_colorpicker" data-field="color" />
                                </div>
                            </div>
                            <div class="oe_kanban_content">
                                <div>
                                    <strong>
                                        <field name="name" />
                                    </strong>
                                </div>
                                <div class="text-muted">
                                    <a>Practice :</a>
                                    <field name="practice_id"/>
                                </div>
                                <div class="text-muted">
                                    <a>Practitioner :</a>
                                    <field name="practitioner_id"/>
                                </div>
                                <div class="text-muted">
                                    <a>Patient :</a>
                                    <field name="patient_id"/>
                                </div>
                                <div class="text-muted">
                                    <a>Date :</a>
                                    <field name="prescription_date" />
                                </div>
                            </div>
                            <div class="oe_clear" />
                        </div>
                    </t>
                </templates>
            </kanban>
        </field>
    </record> -->
    <record id="podiatry_prescription_kanban_view" model="ir.ui.view">
        <field name="model">podiatry.prescription</field>
        <field name="arch" type="xml">
            <kanban default_group_by="stage_id" quick_create="true">
                <!-- Field list to ensure is loaded ... -->
                <field name="color" />
                <field name="prescription_line_ids" />
                <field name="num_prescriptions" />
                <field name="state" />
                <progressbar field="kanban_state" colors='{"done": "success", "blocked": "danger","normal": "muted"}' sum_field="num_prescriptions" />
                <templates>
                    <t t-name="patient_photos">
                        <!-- "limit" is a variable set on the t-call -->
                        <div>
                            <t t-foreach="record.prescription_line_ids.raw_value.slice(0, limit)" t-as="line">
                                <group>
                                    <img t-att-src="kanban_image('podiatry.prescription.line', 'left_photo', line)" class="oe_avatar" height="60" alt="Photo" />
                                    <img t-att-src="kanban_image('podiatry.prescription.line', 'right_photo', line)" class="oe_avatar" height="60" alt="Photo" />
                                </group>
                            </t>
                        </div>
                    </t>

                    <t t-name="kanban-box">
                        <div t-attf-class="oe_kanban_global_click
         {{!selection_mode ? 'oe_kanban_color_' +
           kanban_getcolor(record.color.raw_value) : ''}}">

                            <div class="o_dropdown_kanban dropdown">
                                <!-- Top-right drop down menu ... -->
                                <a class="dropdown-toggle btn" role="button" data-toggle="dropdown" title="Dropdown menu" href="#">
                                    <span class="fa fa-ellipsis-v" />
                                </a>
                                <div class="dropdown-menu" role="menu">

                                    <!-- Edit menu option -->
                                    <t t-if="widget.editable">
                                        <a role="menuitem" type="edit" class="dropdown-item">Edit</a>
                                    </t>
                                    <!-- Delete menu option -->
                                    <t t-if="widget.deletable">
                                        <a role="menuitem" type="delete" class="dropdown-item">Delete</a>
                                    </t>

                                    <!-- Separator line -->
                                    <div role="separator" class="dropdown-divider" />

                                    <!-- Color picker option: -->
                                    <ul class="oe_kanban_colorpicker" data-field="color" />

                                    <!-- Set as Done menu option -->
                                    <a t-if="widget.editable and record.state != 'done'" role="menuitem" class="dropdown-item" name="button_done" type="object">Set as Done</a>

                                </div>

                            </div>

                            <div class="oe_kanban_content">
                                <div class="o_kanban_record_title">
                                    <!-- Title area ... -->
                                    <!--
            <strong><field name="name" /></strong>
            -->
                                    <t t-set="red_or_black" t-value="record.num_prescriptions == 0 ? '' : 'oe_kanban_text_red'" />
                                    <strong t-att-class="red_or_black">
                                        <field name="name" />
                                    </strong>
                                </div>
                                <div class="o_kanban_record_body">
                                    <!-- Other content area  ... -->
                                    <!-- Using t-att-f example
            <div t-attf-class="oe_kanban_text_{{
              record.priority.raw_value &lt; '2'
              ? 'black' : 'red' }}">
              <field name="request_date"/>
            </div>
            -->
                                    <div t-att-class="record.priority.raw_value &lt; '2'
              ? 'oe_kanban_text_black' : 'oe_kanban_text_red'">
                                        <field name="request_date" string="Date:"/>
                                    </div>
                                    <div>
                                        <t t-out="'Requested by ' + record.request_date.value" />
                                        <t t-set="calendar_sign">
                                            <i class="fa fa-calendar" title="Calendar" />
                                        </t>
                                        <t t-out="calendar_sign" />
                                    </div>

                                    <div t-if="record.num_prescriptions.raw_value == 0">
              No items!
                                    </div>
                                    <div t-elif="record.num_prescriptions.raw_value == 1">
              One item
                                    </div>
                                    <div t-else="">
                                        <field name="num_prescriptions"/>
 items
                                    </div>

                                    <!--
            <div>
              <t t-foreach="record.prescription_line_ids.raw_value.slice(0, 5)" t-as="line">
                <img t-att-src="kanban_image(
                  'podiatry.prescription.line', 'book_cover', line)" class="oe_avatar" height="60" alt="Cover" />
                </t>
            </div>
            -->
                                    <t t-call="patient_photos">
                                        <t t-set="limit" t-value="3" />
                                    </t>

                                    <div>
                                        <field name="patient_id" widget="many2one_avatar"/>
                                    </div>
                                </div>

                                <div class="o_kanban_record_bottom">
                                    <div class="oe_kanban_bottom_left">
                                        <!-- Left side footer... -->
                                        <field name="priority" widget="priority"/>
                                        <field name="activity_ids" widget="kanban_activity"/>

                                    </div>
                                    <div class="oe_kanban_bottom_right">
                                        <!-- Right side footer... -->
                                        <field name="kanban_state" widget="kanban_state_selection"/>

                                        <field name="user_id" widget="many2one_avatar_user"/>
                                    </div>
                                </div>                                <!-- o_kanban_record_bottom -->

                                <div class="oe_clear"/>
                            </div>                            <!-- oe_kanban_content -->
                        </div>                        <!-- oe_kanban_global_click -->
                    </t>
                </templates>
            </kanban>

        </field>
    </record>
    <record id="res_partner_kanban_inherit" model="ir.ui.view">
        <field name="name">Contact Kanban modification</field>
        <field name="model">res.partner</field>
        <field name="inherit_id" ref="base.res_partner_kanban_view" />
        <field name="arch" type="xml">
            <xpath expr="//t[@t-name='kanban-box']//field[@name='display_name']" position="before">
                <span>Name: </span>
            </xpath>
        </field>
    </record>
    <!-- Form View -->
    <record id="view_podiatry_prescription_form" model="ir.ui.view">
        <field name="name">Prescription</field>
        <field name="model">podiatry.prescription</field>
        <field name="arch" type="xml">
            <form string="Prescription">
                <header>
                    <!-- To add buttons and status widget -->
                    <field name="state" invisible="True" />
                    <button name="button_done" type="object" string="Complete Prescription" attrs="{'invisible': [('state', 'in', ['new', 'done', 'cancel'])]}" states="open" class="oe_highlight" />
                    <field name="stage_id" widget="statusbar" options="{'clickable': True, 'fold_field': 'fold'}" />

                    <!-- <button id="button_confirm" name="action_confirm" string="Confirm" class="btn-warning" type="object" confirm="Are you sure you want to confirm?"/>
                    <button id="button_done" name="action_done" string="Done" class="btn-success" type="object" confirm="Are you sure you want to set done?"/>
                    <button id="button_cancel" name="action_cancel" string="Cancel" class="btn-danger" type="object" confirm="Are you sure you want to cancel?"/> -->
                    <!-- <field name="state" widget="statusbar" statusbar_visible="draft,confirm,done,cancel" options="{'clickable':'1'}"/> -->
                </header>
                <sheet>
                    <div name="button_box" class="oe_button_box">
                        <button type="action" name="%(action_podiatry_prescription_dashboard)d" class="oe_stat_button" icon="fa-file-text-o" domain="[('patient_id', '=', patient_id)]" context="{'default_patient_id': patient_id}">
                            <field name="prescription_count" string="Prescriptions" widget="statinfo" />
                        </button>
                    </div>
                    <group string="Patient and Doctor Information">
                        <group>
                            <field name="patient_id" required="1" options="{&quot;always_reload&quot;: 1}" />
                            <field name="practice_id" required="1" options="{&quot;always_reload&quot;: 1}" />
                            <field name="practitioner_id" required="1" options="{&quot;always_reload&quot;: 1}"/>
                        </group>
                        <group>
                            <field name="name" readonly="1" />
                            <field name="user_id" />
                            <field name="prescription_date" required="1" />
                            <field name="request_date"/>
                        </group>
                    </group>

                    <notebook>
                        <page string="Prescription Details">
                            <group>
                                <field name="attachment_ids" widget="many2many_binary" class="oe_inline"/>
                            </group>
                            <group string="Rx Lines">
                                <field name="prescription_line_ids" nolabel="1" widget="one2many_list" />
                            </group>
                        </page>
                    </notebook>
                    <button name="prescription_report" type="object" string="Print Prescription" class="oe_highlight" />
                    <button name="%(action_create_prescription_invoice1)d" type="action" string="Create Invoice" class="oe_highlight" />
                </sheet>
            </form>
        </field>
    </record>
    <!-- Search -->
    <record id="view_podiatry_prescription_search" model="ir.ui.view">
        <field name="name">podiatry.prescription.search</field>
        <field name="model">podiatry.prescription</field>
        <field name="arch" type="xml">
            <search string="Prescription">
                <field name="name"/>
                <field name="patient_id"/>
                <field name="state"/>
                <field name="practitioner_id"/>
                <separator/>
                <group expand="1" string="Group By">
                    <filter string="State" name="state" context="{'group_by':'state'}"/>
                </group>
            </search>
        </field>
    </record>
    <!-- Calendar View -->
    <record id="view_podiatry_prescription_calendar" model="ir.ui.view">
        <field name="name">Practitioner Prescriptions</field>
        <field name="model">podiatry.prescription</field>
        <field eval="2" name="priority"/>
        <field name="arch" type="xml">
            <calendar date_start="request_date" string="orders" mode="month" color="user_id">
                <field name="patient_id"/>
                <field name="practitioner_id"/>
                <!-- <field name="request_date"/> -->
            </calendar>
        </field>
    </record>
    <!-- Pivot View -->
    <record id="view_podiatry_prescription_pivot" model="ir.ui.view">
        <field name="model">podiatry.prescription</field>
        <field name="arch" type="xml">
            <pivot>
                <field name="stage_id" type="col" />
                <field name="patient_id" />
                <field name="request_date" interval="week" />
                <field name="num_prescriptions" type="measure" />
            </pivot>
        </field>
    </record>
    <!-- =Graph View -->
    <record id="view_podiatry_prescription_graph" model="ir.ui.view">
        <field name="model">podiatry.prescription</field>
        <field name="arch" type="xml">
            <graph type="bar">
                <field name="stage_id" />
                <field name="num_prescriptions" type="measure" />
            </graph>
        </field>
    </record>

    <!-- action window for prescription dashboard -->
    <record id="action_podiatry_prescription_dashboard" model="ir.actions.act_window">
        <field name="name">Prescriptions</field>
        <field name="res_model">podiatry.prescription</field>
        <field name="view_mode">kanban,tree,form,calendar,pivot,graph,activity</field>
        <field name="search_view_id" ref="view_podiatry_prescription_search"/>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                Create a new prescription
            </p>
            <p>
                Organize and manage prescriptions at a glance.
            </p>
        </field>
    </record>
    <!-- action window for prescription -->
    <record id="action_podiatry_prescription" model="ir.actions.act_window">
        <field name="name">Prescriptions</field>
        <field name="type">ir.actions.act_window</field>
        <field name="res_model">podiatry.prescription</field>
        <field name="view_mode">kanban,tree,form,calendar,pivot,graph,activity</field>
        <field name="context">{}</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                Create New Prescription
            </p>
        </field>
    </record>
    <!-- action server for changing the state to confirmed -->
    <record id="action_prescription_confirm" model="ir.actions.server">
        <field name="name">Confirm prescription</field>
        <field name="type">ir.actions.server</field>
        <field name="model_id" ref="model_podiatry_prescription"/>
        <field name="binding_model_id" ref="model_podiatry_prescription"/>
        <field name="binding_view_types">kanban,list,form</field>
        <field name="state">code</field>
        <field name="code">records.action_confirm()</field>
    </record>
    <!-- action server for changing the state to done -->
    <record id="action_prescription_done" model="ir.actions.server">
        <field name="name">Done prescription</field>
        <field name="type">ir.actions.server</field>
        <field name="model_id" ref="model_podiatry_prescription"/>
        <field name="binding_model_id" ref="model_podiatry_prescription"/>
        <field name="binding_view_types">kanban,list,form</field>
        <field name="state">code</field>
        <field name="code">records.action_done()</field>
    </record>
    <!-- action server for changing the staete to canceled -->
    <record id="action_prescription_cancel" model="ir.actions.server">
        <field name="name">Cancel prescription</field>
        <field name="type">ir.actions.server</field>
        <field name="model_id" ref="model_podiatry_prescription"/>
        <field name="binding_model_id" ref="model_podiatry_prescription"/>
        <field name="binding_view_types">kanban,list,form</field>
        <field name="state">code</field>
        <field name="code">records.action_cancel()</field>
    </record>
    <!--
    menu: Prescriptons
    -->
    <menuitem id="menu_podiatry_prescriptions" name="Prescriptions" action="action_podiatry_prescription_dashboard" parent="menu_root" sequence="20" />


    <!-- action window for prescription stages -->

    <record id="action_podiatry_prescription_stages" model="ir.actions.act_window">
        <field name="name">Stages</field>
        <field name="res_model">podiatry.prescription.stage</field>
        <field name="view_mode">tree,form</field>
    </record>

    <!--
      Settings / Stages
    -->
    <menuitem id="menu_podiatry_prescription_stages" name="Stages" action="action_podiatry_prescription_stages" groups="group_manager" parent="menu_configuration" sequence="20" />

</odoo>
