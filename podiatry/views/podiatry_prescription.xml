<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Tree View -->
    <record id="view_podiatry_prescription_list" model="ir.ui.view">
        <field name="name">Practitioner Prescriptions</field>
        <field name="model">podiatry.prescription</field>
        <field name="arch" type="xml">
            <tree>
                <field name="name"/>
                <field name="date"/>
                <field name="time"/>
                <field name="practice_id"/>
                <field name="practitioner_id"/>
                <field name="patient_id"/>
                <field name="user_id" />
                <field name="diagnosis_id"/>
                <field name="description"/>
            </tree>
        </field>
    </record>
    <!-- Kanban View -->
    <record id="podiatry_prescription_kanban_view" model="ir.ui.view">
        <field name="model">podiatry.prescription</field>
        <field name="arch" type="xml">
            <kanban default_group_by="stage_id" quick_create="true">
                <!-- Field list to ensure is loaded ... -->
                <field name="color" />
                <field name="prescription_line_ids" />
                <field name="num_prescriptions" />
                <field name="state" />
                <progressbar field="kanban_state" colors='{"done": "success", "blocked": "danger","normal": "muted"}' sum_field="num_prescriptions" />
                <templates>
                    <t t-name="patient_photos">
                        <!-- "limit" is a variable set on the t-call -->
                        <div>
                            <t t-foreach="record.prescription_line_ids.raw_value.slice(0, limit)" t-as="line">
                                <group>
                                    <img t-att-src="kanban_image('podiatry.prescription.line', 'left_photo', line)" class="oe_avatar" height="60" alt="Photo" />
                                    <img t-att-src="kanban_image('podiatry.prescription.line', 'right_photo', line)" class="oe_avatar" height="60" alt="Photo" />
                                </group>
                            </t>
                        </div>
                    </t>

                    <t t-name="kanban-box">
                        <div t-attf-class="oe_kanban_global_click
         {{!selection_mode ? 'oe_kanban_color_' +
           kanban_getcolor(record.color.raw_value) : ''}}">

                            <div class="o_dropdown_kanban dropdown">
                                <!-- Top-right drop down menu ... -->
                                <a class="dropdown-toggle btn" role="button" data-toggle="dropdown" title="Dropdown menu" href="#">
                                    <span class="fa fa-ellipsis-v" />
                                </a>
                                <div class="dropdown-menu" role="menu">

                                    <!-- Edit menu option -->
                                    <t t-if="widget.editable">
                                        <a role="menuitem" type="edit" class="dropdown-item">Edit</a>
                                    </t>
                                    <!-- Delete menu option -->
                                    <t t-if="widget.deletable">
                                        <a role="menuitem" type="delete" class="dropdown-item">Delete</a>
                                    </t>

                                    <!-- Separator line -->
                                    <div role="separator" class="dropdown-divider" />

                                    <!-- Color picker option: -->
                                    <ul class="oe_kanban_colorpicker" data-field="color" />

                                    <!-- Set as Done menu option -->
                                    <a t-if="widget.editable and record.state != 'done'" role="menuitem" class="dropdown-item" name="button_done" type="object">Set as Done</a>

                                </div>

                            </div>

                            <div class="oe_kanban_content">
                                <div class="o_kanban_record_title">
                                    <!-- Title area ... -->
                                    <!--
            <strong><field name="name" /></strong>
            -->
                                    <t t-set="red_or_black" t-value="record.num_prescriptions == 0 ? '' : 'oe_kanban_text_red'" />
                                    <strong t-att-class="red_or_black">
                                        <field name="name" />
                                    </strong>
                                </div>
                                <div class="o_kanban_record_body">
                                    <!-- Other content area  ... -->
                                    <!-- Using t-att-f example
            <div t-attf-class="oe_kanban_text_{{
              record.priority.raw_value &lt; '2'
              ? 'black' : 'red' }}">
              <field name="request_date"/>
            </div>
            -->
                                    <div t-att-class="record.priority.raw_value &lt; '2'
              ? 'oe_kanban_text_black' : 'oe_kanban_text_red'">
                                        <field name="request_date" string="Date:"/>
                                    </div>
                                    <div>
                                        <t t-out="'Requested by ' + record.request_date.value" />
                                        <t t-set="calendar_sign">
                                            <i class="fa fa-calendar" title="Calendar" />
                                        </t>
                                        <t t-out="calendar_sign" />
                                    </div>

                                    <div t-if="record.num_prescriptions.raw_value == 0">
              No items!
                                    </div>
                                    <div t-elif="record.num_prescriptions.raw_value == 1">
              One item
                                    </div>
                                    <div t-else="">
                                        <field name="num_prescriptions"/>
 items
                                    </div>

                                    <!--
            <div>
              <t t-foreach="record.prescription_line_ids.raw_value.slice(0, 5)" t-as="line">
                <img t-att-src="kanban_image(
                  'podiatry.prescription.line', 'book_cover', line)" class="oe_avatar" height="60" alt="Cover" />
                </t>
            </div>
            -->
                                    <t t-call="patient_photos">
                                        <t t-set="limit" t-value="3" />
                                    </t>

                                    <div>
                                        <field name="patient_id" widget="many2one_avatar"/>
                                    </div>
                                </div>

                                <div class="o_kanban_record_bottom">
                                    <div class="oe_kanban_bottom_left">
                                        <!-- Left side footer... -->
                                        <field name="priority" widget="priority"/>
                                        <field name="activity_ids" widget="kanban_activity"/>

                                    </div>
                                    <div class="oe_kanban_bottom_right">
                                        <!-- Right side footer... -->
                                        <field name="kanban_state" widget="kanban_state_selection"/>

                                        <field name="user_id" widget="many2one_avatar_user"/>
                                    </div>
                                </div>                                <!-- o_kanban_record_bottom -->

                                <div class="oe_clear"/>
                            </div>                            <!-- oe_kanban_content -->
                        </div>                        <!-- oe_kanban_global_click -->
                    </t>
                </templates>
            </kanban>

        </field>
    </record>
    <record id="res_partner_kanban_inherit" model="ir.ui.view">
        <field name="name">Contact Kanban modification</field>
        <field name="model">res.partner</field>
        <field name="inherit_id" ref="base.res_partner_kanban_view" />
        <field name="arch" type="xml">
            <xpath expr="//t[@t-name='kanban-box']//field[@name='display_name']" position="before">
                <span>Name: </span>
            </xpath>
        </field>
    </record>
    <!-- Calendar View -->
    <record id="view_podiatry_prescription_calendar" model="ir.ui.view">
        <field name="name">Practitioner Prescriptions</field>
        <field name="model">podiatry.prescription</field>
        <field eval="2" name="priority"/>
        <field name="arch" type="xml">
            <calendar date_start="date" string="orders" mode="month" color="color">
                <field name="patient_id"/>
                <field name="practitioner_id"/>
                <field name="date"/>
            </calendar>
        </field>
    </record>
    <!-- Form View -->
    <record id="view_podiatry_prescription_form" model="ir.ui.view">
        <field name="name">Prescription</field>
        <field name="model">podiatry.prescription</field>
        <field name="arch" type="xml">
            <form string="Prescription">
                <header>
                    <button id="button_confirm" name="action_confirm" string="Confirm" class="btn-warning" type="object" confirm="Are you sure you want to confirm?"/>
                    <button id="button_done" name="action_done" string="Done" class="btn-success" type="object" confirm="Are you sure you want to set done?"/>
                    <button id="button_cancel" name="action_cancel" string="Cancel" class="btn-danger" type="object" confirm="Are you sure you want to cancel?"/>
                    <field name="state" widget="statusbar" statusbar_visible="draft,confirm,done,cancel" options="{'clickable':'1'}"/>
                </header>
                <sheet>
                    <group string="Patient and Doctor Information">
                        <group>
                            <field name="patient_id" required="1" options="{&quot;always_reload&quot;: 1}" />
                            <field name="practice_id" required="1" options="{&quot;always_reload&quot;: 1}" />
                            <!-- <field name="prescription_date" required="1" /> -->

                            <field name="bookin_date" />
                            <!-- <field name="bookout_date" /> -->

                        </group>
                        <group>
                            <field name="name" readonly="1" />
                            <field name="user_id" />
                            <field name="practitioner_id" required="1" />
                        </group>
                    </group>

                    <notebook>
                        <page string="Prescription Details">
                            <group>
                                <field name="attachment_ids" widget="many2many_binary" class="oe_inline"/>
                            </group>
                            <group string="Rx Lines">
                                <field name="prescription_line_ids" nolabel="1" widget="one2many_list" />
                            </group>
                        </page>
                    </notebook>
                    <button name="prescription_report" type="object" string="Print Prescription" class="oe_highlight" />
                    <button name="%(action_create_prescription_invoice1)d" type="action" string="Create Invoice" class="oe_highlight" />
                </sheet>
            </form>
        </field>
    </record>

    <!-- Search -->
    <record id="view_podiatry_prescription_search" model="ir.ui.view">
        <field name="name">podiatry.prescription.search</field>
        <field name="model">podiatry.prescription</field>
        <field name="arch" type="xml">
            <search string="Prescription">
                <field name="name"/>
                <field name="patient_id"/>
                <!-- <field name="gender"/> -->
                <!-- <field name="phone" groups="km_hospital.group_hospital_admin"/> -->
                <!-- <field name="age"/> -->
                <field name="state"/>
                <field name="practitioner_id"/>
                <separator/>
                <!-- <filter string="Male" name="male" domain="[('gender', '=', 'male')]"/>
                <filter string="Female" name="female" domain="[('gender', '=', 'female')]"/> -->
                <group expand="1" string="Group By">
                    <filter string="State" name="state" context="{'group_by':'state'}"/>
                </group>
            </search>
        </field>
    </record>

    <!-- Action: Prescriptions (Dashboard) -->
    <record id="action_podiatry_prescription_dashboard" model="ir.actions.act_window">
        <field name="name">Prescriptions</field>
        <field name="res_model">podiatry.prescription</field>
        <field name="view_mode">kanban,tree,form</field>
        <field name="search_view_id" ref="view_podiatry_prescription_search"/>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                Create a new prescription
            </p>
            <p>
                Organize and manage prescriptions at a glance.
            </p>
        </field>
    </record>

    <!-- calender view -->
    <record id="prescription_view_calendar" model="ir.ui.view">
        <field name="name">podiatry.prescription.calendar</field>
        <field name="model">podiatry.prescription</field>
        <field name="arch" type="xml">
            <calendar string="Prescriptions" date_start="bookin_date" date_stop="bookout_date" event_open_popup="true" mode="month" color="name" quick_add="False">
                <field name="patient_id"/>
            </calendar>
        </field>
    </record>

    <!-- pivot view -->
    <record id="prescription_pivot" model="ir.ui.view">
        <field name="name">podiatry.prescription.pivot</field>
        <field name="model">podiatry.prescription</field>
        <field name="arch" type="xml">
            <pivot string="Prescriptions Pivot View">
                <field name="patient_id" type="row"/>
            </pivot>
        </field>
    </record>

    <record id="prescription_action" model="ir.actions.act_window">
        <field name="name">Prescriptions</field>
        <field name="type">ir.actions.act_window</field>
        <field name="res_model">podiatry.prescription</field>
        <field name="view_mode">tree,form,search,kanban,calendar,pivot</field>
        <field name="context">{}</field>
        <!--for default group & filter => {'search_default_state': 1, 'search_default_male': 1}-->
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                Create New Prescription
            </p>
        </field>
    </record>

    <!-- action server for changing the state to confirmed -->
    <record id="action_prescription_confirm" model="ir.actions.server">
        <field name="name">Confirm prescription</field>
        <field name="type">ir.actions.server</field>
        <field name="model_id" ref="model_podiatry_prescription"/>
        <field name="binding_model_id" ref="model_podiatry_prescription"/>
        <field name="binding_view_types">list,form</field>
        <field name="state">code</field>
        <field name="code">records.action_confirm()</field>
    </record>

    <!-- action server for changing the state to done -->
    <record id="action_prescription_done" model="ir.actions.server">
        <field name="name">Done prescription</field>
        <field name="type">ir.actions.server</field>
        <field name="model_id" ref="model_podiatry_prescription"/>
        <field name="binding_model_id" ref="model_podiatry_prescription"/>
        <field name="binding_view_types">list,form</field>
        <field name="state">code</field>
        <field name="code">records.action_done()</field>
    </record>

    <!-- action server for changing the staete to canceled -->
    <record id="action_prescription_cancel" model="ir.actions.server">
        <field name="name">Cancel prescription</field>
        <field name="type">ir.actions.server</field>
        <field name="model_id" ref="model_podiatry_prescription"/>
        <field name="binding_model_id" ref="model_podiatry_prescription"/>
        <field name="binding_view_types">list,form</field>
        <field name="state">code</field>
        <field name="code">records.action_cancel()</field>
    </record>

    <!--
    menu: Prescriptons
    -->
    <menuitem id="menu_podiatry_prescriptions" name="Prescriptions" action="action_podiatry_prescription_dashboard" parent="menu_root" sequence="20" />




</odoo>
