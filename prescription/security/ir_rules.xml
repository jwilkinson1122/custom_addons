<?xml version="1.0" encoding="utf-8"?>
<odoo noupdate="1">

   <!-- Record Rules -->
    <record id="prescription_rule_user_own" model="ir.rule">
        <field name="name">Personal Prescription</field>
        <field name="model_id" ref="prescription.model_prescription" />
        <field name="domain_force">['|',('user_id','=',user.id),('user_id','=',False)]</field>
        <field name="groups" eval="[(4, ref('prescription_contacts.group_contacts_user'))]" />
    </record>

    <record id="prescription_rule_user_all" model="ir.rule">
        <field name="name">All Prescription</field>
        <field name="model_id" ref="prescription.model_prescription" />
        <field name="domain_force">[(1,'=',1)]</field>
        <field name="groups" eval="[(4, ref('prescription_contacts.group_contacts_user_all'))]" />
    </record>

    <!-- Portal Access Rules -->
    <record id="prescription_rule_portal" model="ir.rule">
        <field name="name">Prescription portal users</field>
        <field name="model_id" ref="prescription.model_prescription" />
        <field name="domain_force">[('message_partner_ids', 'child_of', [user.partner_id.commercial_partner_id.id])]</field>
        <field name="groups" eval="[(4, ref('base.group_portal'))]" />
    </record>

    <!-- Multi-Company Rules -->
    <record id="prescription_comp_rule" model="ir.rule">
        <field name="name">Prescription multi-company</field>
        <field name="model_id" ref="prescription.model_prescription" />
        <field name="global" eval="True" />
        <field name="domain_force">['|',('company_id','=',False),('company_id','in',company_ids)]</field>
    </record>

    <record id="prescription_team_comp_rule" model="ir.rule">
        <field name="name">Prescription team multi-company</field>
        <field name="model_id" ref="prescription.model_prescription_team" />
        <field name="global" eval="True" />
        <field name="domain_force">['|',('company_id','=',False),('company_id','in',company_ids)]</field>
    </record>

    <record id="prescription_finalization_comp_rule" model="ir.rule">
        <field name="name">Prescription Finalization Reason multi-company</field>
        <field name="model_id" ref="prescription.model_prescription_finalization" />
        <field name="global" eval="True" />
        <field name="domain_force"> ['|', ('company_id', 'in', company_ids), ('company_id', '=', False)]</field>
    </record>

    <!-- Allow to refund Prescription -->
    <record id="prescription_account_move_personal_rule" model="ir.rule">
        <field name="name">Prescription Personal Invoice</field>
        <field ref="model_account_move" name="model_id" />
        <field name="domain_force">[('move_type', '=', 'out_refund'), '|', ('invoice_user_id', '=', user.id), ('invoice_user_id', '=', False)]</field>
        <field name="groups" eval="[(4, ref('prescription_contacts.group_contacts_user'))]" />
    </record>

    <record id="prescription_account_move_line_personal_rule" model="ir.rule">
        <field name="name">Prescription Personal Invoice Lines</field>
        <field ref="model_account_move_line" name="model_id" />
        <field name="domain_force">[('move_id.move_type', '=', 'out_refund'), '|', ('move_id.invoice_user_id', '=', user.id), ('move_id.invoice_user_id', '=', False)]</field>
        <field name="groups" eval="[(4, ref('prescription_contacts.group_contacts_user'))]" />
    </record>


</odoo>
